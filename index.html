<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OIDC認証サンプル</title>
</head>
<body>
    <!-- サインインボタン -->
    <div id="signin-section">
        <button id="signIn">Sign In</button>
    </div>

    <!-- 認証後の情報表示 -->
    <div id="user-info" style="display: none;">
        Hello: <pre id="email"></pre>
        Access token: <pre id="access-token"></pre>
        ID token: <pre id="id-token"></pre>
        Refresh token: <pre id="refresh-token"></pre>
    </div>

    <script type="module">
        import { userManager } from "graduate-front\amplify\auth\auth.ts";
        
        // ページ読み込み時の処理
        window.addEventListener('DOMContentLoaded', async () => {
            // URLパラメータをチェックして認証コールバックかどうか判定
            const urlParams = new URLSearchParams(window.location.search);
            
            if (urlParams.has('code') || urlParams.has('state')) {
                // 認証コールバック処理
                try {
                    const user = await userManager.signinCallback();
                    displayUserInfo(user);
                } catch (error) {
                    console.error("認証エラー:", error);
                }
            } else {
                // 通常のページ表示
                document.getElementById("signin-section").style.display = "block";
            }
        });

        // サインインボタンのクリックイベント
        document.getElementById("signIn").addEventListener("click", async () => {
            await userManager.signinRedirect();
        });

        // ユーザー情報を表示する関数
        function displayUserInfo(user) {
            document.getElementById("signin-section").style.display = "none";
            document.getElementById("user-info").style.display = "block";
            
            document.getElementById("email").textContent = user.profile?.email;
            document.getElementById("access-token").textContent = user.access_token;
            document.getElementById("id-token").textContent = user.id_token;
            document.getElementById("refresh-token").textContent = user.refresh_token;
        }
    </script>
</body>
</html>