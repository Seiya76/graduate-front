<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OIDC認証サンプル</title>
</head>
<body>
    <!-- サインインボタン -->
    <div id="signin-section">
        <button id="signIn">Sign In</button>
    </div>

    <!-- 認証後の情報表示 -->
    <div id="user-info" style="display: none;">
        <h2>認証成功</h2>
        Hello: <pre id="email"></pre>
        Access token: <pre id="access-token"></pre>
        ID token: <pre id="id-token"></pre>
        Refresh token: <pre id="refresh-token"></pre>
        <button id="signOut">Sign Out</button>
    </div>

    <script type="module">
        import { userManager } from "graduate-front\amplify\auth\auth.ts";
        
        // URLにコールバック用のパラメータがあるかチェック
        if (window.location.search.includes('code=') || window.location.search.includes('error=')) {
            // コールバック処理
            userManager.signinCallback().then(function (user) {
                document.getElementById("signin-section").style.display = "none";
                document.getElementById("user-info").style.display = "block";
                
                document.getElementById("email").textContent = user.profile?.email;
                document.getElementById("access-token").textContent = user.access_token;
                document.getElementById("id-token").textContent = user.id_token;
                document.getElementById("refresh-token").textContent = user.refresh_token;
                
                // URLからパラメータを削除
                window.history.replaceState({}, document.title, window.location.pathname);
            }).catch(function (error) {
                console.error("認証エラー:", error);
            });
        } else {
            // 通常のサインイン処理
            document.getElementById("signIn").addEventListener("click", async () => {
                await userManager.signinRedirect();
            });
        }
        
        // サインアウト処理
        document.getElementById("signOut").addEventListener("click", async () => {
            await userManager.signoutRedirect();
        });
    </script>
</body>
</html>